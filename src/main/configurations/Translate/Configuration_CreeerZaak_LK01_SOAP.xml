<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
    <Adapter name="CreeerZaak_Lk01_SOAP"
        active="${CreeerZaak_Lk01_SOAP.Active}"
        description="">

        <Receiver name="CreeerZaak_Lk01_SOAP">
            <WebServiceListener name="CreeerZaak_Lk01_SOAP" address="${address.CreeerZaak_LK01}" soap="false"/>
            <!-- <JdbcErrorStorage
                name="JdbcErrorStorage"
                datasourceName="jdbc/openZaakBrug"
                slotId="${instance.name}/creeerZaak"/> -->
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit path="EXIT" state="SUCCESS"/>
                <Exit path="EXCEPTION" state="ERROR"/>
            </Exits>
            
            <SoapInputValidator
                name="InputValidator"
                schemaLocation="http://www.egem.nl/StUF/sector/zkn/0310 CreeerZaak_LK01/xsd/zkn0310_msg_zs-dms_resolved2017.xsd"
                soapBody="zakLk01"
                reasonSessionKey="errorMsg"
                ignoreUnknownNamespaces="true"
                deepSearch="true"
                cmhVersion="2">
                <Forward name="failure" path="InvalidXml"/>
                <Forward name="parserError" path="NotWellFormed"/>
            </SoapInputValidator>

            <!-- <WsdlXmlInputValidator 
                name="InputValidator" 
				soapBody="zakLk01" soapHeader="Header"
				wsdl="CreeerZaak_LK01/xsd/zkn0310_ontvangAsynchroon_mutatie_zs-dms.wsdl">
				<Forward name="failure" path="InvalidXml"/>
                <Forward name="parserError" path="NotWellFormed"/>
			</WsdlXmlInputValidator> -->

            <SoapWrapperPipe
                name="UnwrapMessage"
                storeResultInSessionKey="UnwrapMessageResult"
                direction="UNWRAP"
                removeOutputNamespaces="true">
                <Forward name="success" path="CallCreeerZaak"/>
            </SoapWrapperPipe>

            <SenderPipe
                name="CallCreeerZaak">
                <IbisLocalSender
                    name="CreeerZaakSender"
                    javaListener="CreeerZaak_Lk01">
                </IbisLocalSender>
                <Forward name="succes" path="WrapBv03Response" />
                <Forward name="exception" path="BackEndError" />
            </SenderPipe>
           
            <SoapWrapperPipe
                name="WrapBv03Response"
                soapBodyStyleSheet="Common/xsl/CreateBv03Response.xslt"
                >
                <Param name="UnwrapMessageResult"   sessionKey="UnwrapMessageResult" type="DOMDOC"/>
                <Forward name="success" path="EXIT"/>
            </SoapWrapperPipe>

            <!-- ERRORS -->

            <PutInSessionPipe name="InvalidXml">
                <Param name="errorCode" value="INVALID_XML"/>
                <Param name="errorReason" value="XML was invalid"/>
                <Forward name="success" path="WrapFo03Response" />
            </PutInSessionPipe>

            <PutInSessionPipe name="NotWellFormed">
                <Param name="errorCode" value="NOT_WELL_FORMED_XML"/>
                <Param name="errorReason" value="XML was not according to xsd"/>                
                <Forward name="success" path="WrapFo03Response"/>
            </PutInSessionPipe>

            <PutInSessionPipe name="BackEndError">
                <Param name="errorCode"   value="BackendError"/>
                <Param name="errorReason" value="BackendError"/>                
                <Forward name="success" path="WrapFo03Response"/>
            </PutInSessionPipe>

            <SoapWrapperPipe
                name="WrapFo03Response"
                soapBodyStyleSheet="Common/xsl/CreateFo03Response.xslt"
                >
                <Param name="UnwrapMessageResult" sessionKey="originalMessage" type="DOMDOC"/>
                <Param name="errorCode"   sessionKey="errorCode"/>
                <Param name="errorReason" sessionKey="errorReason"/>
                <Param name="errorDetailText" value="''"/>
                <Param name="errorDetailXML" value="''"/>
                <Forward name="success" path="EXIT"/>
            </SoapWrapperPipe>
        </Pipeline>
    </Adapter>
</Module>