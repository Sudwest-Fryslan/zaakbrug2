<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../ibisdoc.xsd">
    <Adapter name="DetectRolChanges"
        active="${DetectRolChanges.Active}"
        description="">

        <Receiver name="DetectRolChanges">
            <JavaListener name="DetectRolChanges"/>
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit path="EXIT" state="SUCCESS"/>
                <Exit path="EXCEPTION" state="ERROR"/>
            </Exits>

			<XmlSwitchPipe 
                name="DetectRolChanges" 
                styleSheetName="UpdateZaak_LK01/xsl/DetectRolChanges.xsl"
                >
                <Param name="RolBody_1" sessionKey="RolBody_1" type="DOMDOC"/>
                <Forward name="New" path="CallAddRolToZgw"/>
                <Forward name="Delete" path="CallDeleteRol"/>
                <Forward name="Changed" path="CallUpdateRolInZgw"/>
            </XmlSwitchPipe>

            <SenderPipe name="CallAddRolToZgw"
                getInputFromSessionKey="ZgwZaak"
                storeResultInSessionKey="AddRolResult">
                <IbisLocalSender
                    name="CallAddRolToZgwSender"
                    javaListener="AddRolToZgw">
                    <Param name="GetRolTypeResult" sessionKey="GetRolTypeResult" type="DOMDOC"/>
                    <Param name="ZaakTypeUrl" xpathExpression="$GetZaakTypeResult/zgwZaakType/ZaakType/url">
                        <Param name="GetZaakTypeResult" sessionKey="GetZaakTypeResult" type="DOMDOC"/>
                    </Param>
                </IbisLocalSender>
                <Forward name="success" path="EXIT"/>
            </SenderPipe>

            <SenderPipe name="CallDeleteRolFromZgw"
                getInputFromSessionKey="originalMessage"
                storeResultInSessionKey="DeleteRolResult">
                <IbisLocalSender
                    name="CallDeleteRolSender"
                    javaListener="DeleteRolFromZgw">
                    <Param name="ZgwZaak" sessionKey="ZgwZaak"/>
                    <Param name="ZaakTypeUrl" sessionKey="ZaakTypeUrl"/>
                </IbisLocalSender>
                <Forward name="success" path="EXIT"/>
            </SenderPipe>

            <SenderPipe name="CallUpdateRolInZgw"
                getInputFromSessionKey="originalMessage"
                storeResultInSessionKey="UpdateRolResult">
                <IbisLocalSender
                    name="CallUpdateRolInZgwSender"
                    javaListener="UpdateRolInZgw">
                    <Param name="GetRolTypeResult" sessionKey="GetRolTypeResult" type="DOMDOC"/>
                    <Param name="ZaakTypeUrl" xpathExpression="$GetZaakTypeResult/zgwZaakType/ZaakType/url">
                        <Param name="GetZaakTypeResult" sessionKey="GetZaakTypeResult" type="DOMDOC"/>
                    </Param>
                </IbisLocalSender>
                <Forward name="success" path="EXIT"/>
            </SenderPipe>
        </Pipeline>
    </Adapter>
</Module>