<Module
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../ibisdoc.xsd">
  
  <Adapter name="Translate_creerZaak_Lk01">
	  <Receiver name="TranslateRouter_BeantwoordVraag__creerZaak_Lk01">
			<WebServiceListener name="TranslateRouter_BeantwoordVraag__creerZaak_Lk01" address="translate/generic/zds/BeantwoordVraag" soap="true"/>
		</Receiver>
      <Pipeline>

			<PutInSessionPipe name="storeZdsZaak">
				<Param name="zdsZaak" xpathExpression="/zakLk01/object[@entiteittype='ZAK']" type="xml"/>
			</PutInSessionPipe>

			<XsltPipe name="mapZdsZaakToZgwZaak" styleSheetName="creeerZaak_Lk01/xsl/to_zgwZaakPut.xsl" getInputFromSessionKey="zdsZaak" storeResultInSessionKey="zgwZaakPut">
			<Param name="rsin" value="823288444"/>
			</XsltPipe>

			<Json2XmlValidatorPipe name="responseToJson" schema="creeerZaak_Lk01/xsd/zgwZaakPut.xsd" root="ZgwZaakPut" outputFormat="JSON" throwException="true" storeResultInSessionKey="zgwZaakPutJson"/>

			<EchoPipe name="tempHarcodedJwtToken" 
                storeResultInSessionKey="token" 
                getInputFromFixedValue="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImNsaWVudF9pZGVudGlmaWVyIjoiRnJhbmsifQ.eyJpc3MiOiJGcmFuayIsImlhdCI6MTYzNzI0MDUzMiwiY2xpZW50X2lkIjoiRnJhbmsiLCJ1c2VyX2lkIjoiIiwidXNlcl9yZXByZXNlbnRhdGlvbiI6IiJ9.ub_zWemfV4a0gJFa8cIVfvUz_1EBl-PUBrc7qr0QDsI"
                />

			<SenderPipe name="getZgwZaakTypeByIdentificatie" getInputFromFixedValue="&lt;dummy/&gt;" storeResultInSessionKey="zaakTypeJson">
				<HttpSender 
					name="getZgwZaakTypeByIdentificatie" 
					methodType="GET"
					headersParams="Authorization,Accept-Crs"
					url="${zgw.baseurl}${zgw.endpoint.zaaktype}?identificatie=${identificatie}&amp;status=${status}"
				>
					<Param name="identificatie" xpathExpression="/root/identificatie"/>
                    <Param name="status" value="definitief"/>
					<Param name="Accept-Crs" value="EPSG:4326"/>
					<Param name="Authorization" xpathExpression="concat('Bearer ', $token)" >
						<Param name="token" sessionKey="token" />
					</Param>
				</HttpSender>
			</SenderPipe>

			<JsonPipe name="ZaakTypeXml"/>

			<PutInSessionPipe name="storeZaakType">
				<Param name="zaakType" xpathExpression="/root/results"/>
			</PutInSessionPipe>

			<!--For each-->
			<SenderPipe name="addZgwRolToZaak" getInputFromFixedValue="&lt;dummy/&gt;" storeResultInSessionKey="TODO:Keep id info for potential rollback">
				<HttpSender 
					name="addZgwRolToZaak" 
					methodType="POST"
					headersParams="Authorization,Accept-Crs"
					url="${zgw.baseurl}${zgw.endpoint.rol}?identificatie=${identificatie}&amp;status=${status}"
				>
					<Param name="identificatie" xpathExpression="/root/identificatie"/>
                    <Param name="status" value="definitief"/>
					<Param name="Accept-Crs" value="EPSG:4326"/>
					<Param name="Authorization" xpathExpression="concat('Bearer ', $token)" >
						<Param name="token" sessionKey="token" />
					</Param>
				</HttpSender>
			</SenderPipe>

			<!-- <JsonPipe name="json_zaaktype"/>

			<pipe name="PutZaakTypeValues" className="nl.nn.adapterframework.pipes.PutParametersInSession">
				<Param name="ZaakTypeIdentificatie" xpathExpression="/root/identificatie"/>
				<Param name="ZaakTypeOmschrijving" xpathExpression="/root/omschrijving"/>
				<Param name="informatieObjectTypen" xpathExpression="/root/informatieobjecttypen"/>
			</pipe> -->

			<!-- <SenderPipe name="getAfzender" getInputFromFixedValue="&lt;dummy/&gt;">
				<HttpSender 
					name="httpSender" 
					methodType="GET"
					headersParams="Authorization,Accept-Crs"
				>
					<Param name="url"  xpathExpression="concat('${openzaak.baseurl}zaken/api/v1/rollen?zaak=', $zaakUrl)">
						<Param name="zaakUrl" sessionKey="zaakUrl"/>
					</Param>
					<Param name="Accept-Crs" value="EPSG:4326"/>
					<Param name="Authorization" xpathExpression="concat('Bearer ', $token)" >
						<Param name="token" sessionKey="token" />
					</Param>
				</HttpSender>
			</SenderPipe> -->

			<!-- <JsonPipe name="json_roltypen"/>

			<pipe name="PutAfzenderValuesInSession" className="nl.nn.adapterframework.pipes.PutParametersInSession">
				<Param name="AfzenderLastName" xpathExpression="/root/results[omschrijving='Initiator']/betrokkeneIdentificatie/geslachtsnaam"/>
				<Param name="AfzenderLetters" xpathExpression="/root/results[omschrijving='Initiator']/betrokkeneIdentificatie/voorletters"/>
			</pipe> -->

			<!-- <SenderPipe name="getDocuments" getInputFromFixedValue="&lt;dummy/&gt;">
				<HttpSender 
					name="httpSender" 
					methodType="GET"
					headersParams="Authorization,Accept-Crs"
				>
					<Param name="url"  xpathExpression="concat('${openzaak.baseurl}zaken/api/v1/zaakinformatieobjecten?zaak=', $zaakUrl)">
						<Param name="zaakUrl" sessionKey="zaakUrl"/>
					</Param>
					<Param name="Accept-Crs" value="EPSG:4326"/>
					<Param name="Authorization" xpathExpression="concat('Bearer ', $token)" >
						<Param name="token" sessionKey="token" />
					</Param>
				</HttpSender>
			</SenderPipe> -->

			<!-- <JsonPipe name="json_zaak_documents"/>

			<XsltPipe name="document names" styleSheetName="xsl/documentNames.xsl" storeResultInSessionKey="documents">
			</XsltPipe>

			<XsltPipe name="createResponse" styleSheetName="xsl/createZaakDetailsMessage.xsl" getInputFromFixedValue="&lt;dummy/&gt;">
				<Param name="zaakId" sessionKey="identificatie"/>
				<Param name="zaakTypeId" sessionKey="ZaakTypeIdentificatie"/>
				<Param name="zaakTypeOmschrijving" sessionKey="ZaakTypeOmschrijving"/>
				<Param name="zaakOmschrijving" sessionKey="omschrijving"/>
				<Param name="afzenderLastname" sessionKey="AfzenderLastName"/>
				<Param name="afzenderLetters" sessionKey="AfzenderLetters"/>
				<Param name="documentNames" sessionKey="documents"/>
				<Param name="zaakUrl" sessionKey="zaakUrl"/>
				<Param name="informatieObjectTypen" sessionKey="informatieObjectTypen"/>
			</XsltPipe>

			<JsonPipe name="responseToJson" direction="XML2JSON"/> -->

			<Exit path="EXIT" state="success"/>
		</Pipeline>
  </Adapter>
</Module>