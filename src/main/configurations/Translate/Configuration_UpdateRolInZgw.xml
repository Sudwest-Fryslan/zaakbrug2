<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../FrankConfig.xsd">
    <Adapter name="UpdateRolInZgw"
        active="${UpdateRolInZgw.Active}"
        description="">

        <Receiver name="UpdateRolInZgw">
            <JavaListener name="UpdateRolInZgw"/>
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="EXIT" state="SUCCESS"/>
                <Exit name="EXCEPTION" state="ERROR"/>
            </Exits>

            <SenderPipe name="CallDeleteRolFromZgw"
                storeResultInSessionKey="DeleteRolResult">
                <IbisLocalSender
                    name="CallDeleteRolSender"
                    javaListener="DeleteRolFromZgw">
                    <Param name="ZgwZaak" sessionKey="ZgwZaak"/>
                    <Param name="ZaakTypeUrl" sessionKey="ZaakTypeUrl"/>
                </IbisLocalSender>
                <Forward name="success" path="EXIT"/>
            </SenderPipe>

            <XmlIfPipe name="CheckForNewValue"
                getInputFromSessionKey="originalMessage"
                xpathExpression="string-length(role/gerelateerde) > 0"
                >
                <Forward name="then" path="CheckForTypeRolOmschrijving"/>
                <Forward name="else" path="EXIT"/>
            </XmlIfPipe>
            
            <XmlIfPipe name="CheckForTypeRolOmschrijving"
                getInputFromSessionKey="originalMessage"
                xpathExpression="string-length(role/gerelateerde/typeRolOmschrijving) > 0"
                >
                <Forward name="then" path="CallAddRolToZgw"/>
                <Forward name="else" path="EXIT"/>
            </XmlIfPipe>

            <SenderPipe name="CallAddRolToZgw"
                getInputFromSessionKey="ZgwZaak"
                storeResultInSessionKey="AddRolResult">
                <IbisLocalSender
                    name="CallAddRolToZgwSender"
                    javaListener="AddRolToZgw">
                    <Param name="GetRolTypeResult" sessionKey="GetRolTypeResult" type="DOMDOC"/>
                    <Param name="ZaakTypeUrl" xpathExpression="$GetZaakTypeResult/zgwZaakType/ZaakType/url">
                        <Param name="GetZaakTypeResult" sessionKey="GetZaakTypeResult" type="DOMDOC"/>
                    </Param>
                </IbisLocalSender>
                <Forward name="success" path="EXIT"/>
            </SenderPipe>
        </Pipeline>
    </Adapter>
</Module>